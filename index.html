
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Machine 5x5 con Bonus Stelle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #2c3e50;
            color: #ecf0f1;
            padding-top: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }

        h1 {
            color: #f1c40f;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        /* Contenitore per la griglia */
        .grid-container {
            background-color: #34495e;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            width: min(90vw, 90vh);
            height: min(90vw, 90vh);
            max-width: 600px;
            max-height: 600px;
            box-sizing: border-box;
            margin-left: auto;
            margin-right: auto;
        }

        .reels-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            width: 100%;
            height: 100%;
            margin: 0;
            aspect-ratio: 1;
        }

        .reel {
            font-size: min(4vw, 4vh);
            background-color: #ecf0f1;
            color: #34495e;
            border: 2px solid #bdc3c7;
            padding: 5px;
            height: auto;
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            transition: background-color 0.2s ease-in-out;
            box-sizing: border-box;
            min-height: 0;
            max-height: 100%;
        }

        button {
            padding: 12px 24px;
            font-size: 1.2em;
            margin-top: 10px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }

        .win-highlight {
            background-color: #FFD700 !important;
        }

        /* Stili per i fuochi d'artificio e il testo bonus (invariati) */
        .firework-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1000;
        }

        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: explode 1s forwards ease-out;
        }
        
        @keyframes explode {
            0% { opacity: 1; transform: scale(0.5); }
            100% { opacity: 0; transform: scale(3) translate(-50%, -50%); }
        }

        .bonus-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8vw;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.6);
            opacity: 0;
            animation: bonusFadeInZoom 1.5s forwards ease-out;
            z-index: 1001;
        }

        @keyframes bonusFadeInZoom {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        }
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            margin-bottom: 20px;
            background-color: #34495e;
            border-radius: 10px;
            width: min(90vw, 90vh);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .score-container {
            font-size: 1.2em;
            font-weight: bold;
            color: #f1c40f;
        }

        .buttons-container {
            display: flex;
            gap: 10px;
        }

        #status-label {
            font-size: 1em;
            margin: 10px 0;
            color: #ecf0f1;
        }
    </style>
</head>
<body>
    <div class="header-container">
        <div class="score-container">
            <span>Punti: </span>
            <span id="score-label">500</span>
        </div>
        <div class="buttons-container">
            <button id="spin-button">Gira</button>
            <button id="auto-button">Auto</button>
        </div>
    </div>

    <p id="status-label">Premi Gira! (Costo: 50)</p>

    <div class="grid-container">
        <div class="reels-grid" id="reels-grid"></div>
    </div>

    <div id="fireworks-container" class="firework-container"></div>

    <script>
        const reelsGrid = document.getElementById('reels-grid');
        const scoreLabel = document.getElementById('score-label');
        const statusLabel = document.getElementById('status-label');
        const spinButton = document.getElementById('spin-button');
        const autoButton = document.getElementById('auto-button');
        const fireworksContainer = document.getElementById('fireworks-container');
        
        const symbols = ['üçí', 'üçã', 'üçä', '‚≠ê', 'üîî', 'üíé'];
        let autoPlayInterval = null;
        let score = 500;
        const spinCost = 50;
        
        const reels = [];
        const REEL_COUNT = 25;
        const WIN_COLOR = '#FFD700';
        const DEFAULT_REEL_BG = '#ecf0f1';

        // Questo √® il blocco di codice che genera le slot.
        // Senza di esso, la griglia rimane vuota.
        for (let i = 0; i < REEL_COUNT; i++) {
            const reel = document.createElement('div');
            reel.classList.add('reel');
            reel.textContent = getRandomSymbol();
            reelsGrid.appendChild(reel);
            reels.push(reel);
        }

        let spinningReels = 0;

        function getRandomSymbol() {
            return symbols[Math.floor(Math.random() * symbols.length)];
        }

        function animateReel(index, spinCount, finalSymbol) {
            if (spinCount > 0) {
                reels[index].textContent = getRandomSymbol();
                const delay = Math.random() * 50 + 20;
                setTimeout(() => animateReel(index, spinCount - 1, finalSymbol), delay);
            } else {
                reels[index].textContent = finalSymbol;
                spinningReels--;
                if (spinningReels === 0) {
                    setTimeout(checkWin, 200);
                }
            }
        }

        function spin() {
            if (score < spinCost) {
                statusLabel.textContent = "Hai finito i crediti!";
                spinButton.disabled = true;
                return;
            }
            
            score -= spinCost;
            scoreLabel.textContent = score;
            statusLabel.textContent = "Gira...";
            spinButton.disabled = true;

            reels.forEach(reel => reel.classList.remove('win-highlight'));
            fireworksContainer.innerHTML = '';

            const finalResults = [];
            spinningReels = REEL_COUNT;

            for (let i = 0; i < REEL_COUNT; i++) {
                const finalSymbol = getRandomSymbol();
                finalResults.push(finalSymbol);
                const spinDuration = Math.floor(Math.random() * 30) + 20;
                animateReel(i, spinDuration, finalResults[i]); 
            }
        }

        function checkWin() {
            let winScore = 0;
            let winningLinesCount = 0;
            const winningReelIndexes = new Set();
            let starBonusTriggered = false;
            
            const currentResults = reels.map(reel => reel.textContent);

            function checkLine(lineIndexes) {
                const lineSymbols = lineIndexes.map(index => currentResults[index]);
                let lineWinScore = 0;
                let lineWinningIndexes = [];
                let isStarLine = false;

                if (lineSymbols.every(sym => sym === '‚≠ê')) {
                     lineWinScore = 1000;
                     lineWinningIndexes = lineIndexes;
                     isStarLine = true;
                }
                else if (lineSymbols[0] === lineSymbols[1] && lineSymbols[1] === lineSymbols[2] && lineSymbols[2] === lineSymbols[3] && lineSymbols[3] === lineSymbols[4]) {
                    lineWinScore += 500;
                    lineWinningIndexes = lineIndexes;
                    if (lineSymbols[0] === '‚≠ê') isStarLine = true;
                }
                else if ((lineSymbols[0] === lineSymbols[1] && lineSymbols[1] === lineSymbols[2] && lineSymbols[2] === lineSymbols[3]) ||

(lineSymbols[1] === lineSymbols[2] && lineSymbols[2] === lineSymbols[3] && lineSymbols[3] === lineSymbols[4])) {
                    lineWinScore += 150;
                    if (lineSymbols[0] === lineSymbols[1] && lineSymbols[1] === lineSymbols[2] && lineSymbols[2] === lineSymbols[3]) {
                        lineWinningIndexes = lineIndexes.slice(0, 4);
                        if (lineSymbols[0] === '‚≠ê') isStarLine = true;
                    } else {
                        lineWinningIndexes = lineIndexes.slice(1, 5);
                        if (lineSymbols[1] === '‚≠ê') isStarLine = true;
                    }
                }
                else if ((lineSymbols[0] === lineSymbols[1] && lineSymbols[1] === lineSymbols[2]) || 
                         (lineSymbols[1] === lineSymbols[2] && lineSymbols[2] === lineSymbols[3]) ||
                         (lineSymbols[2] === lineSymbols[3] && lineSymbols[3] === lineSymbols[4])) {
                    lineWinScore += 50;
                    if (lineSymbols[0] === lineSymbols[1] && lineSymbols[1] === lineSymbols[2]) {
                        lineWinningIndexes = lineIndexes.slice(0, 3);
                        if (lineSymbols[0] === '‚≠ê') isStarLine = true;
                    } else if (lineSymbols[1] === lineSymbols[2] && lineSymbols[2] === lineSymbols[3]) {
                        lineWinningIndexes = lineIndexes.slice(1, 4);
                        if (lineSymbols[1] === '‚≠ê') isStarLine = true;
                    } else {
                        lineWinningIndexes = lineIndexes.slice(2, 5);
                        if (lineSymbols[2] === '‚≠ê') isStarLine = true;
                    }
                }
                return {score: lineWinScore, indexes: lineWinningIndexes, isStar: isStarLine};
            }

            for (let r = 0; r < 5; r++) {
                const lineIndexes = Array.from({length: 5}, (_, c) => r * 5 + c);
                const {score: lineWin, indexes: currentWinningIndexes, isStar} = checkLine(lineIndexes);
                if (lineWin > 0) {
                    winScore += lineWin;
                    winningLinesCount++;
                    currentWinningIndexes.forEach(index => winningReelIndexes.add(index));
                    if (isStar) starBonusTriggered = true;
                }
            }

            for (let c = 0; c < 5; c++) {
                const lineIndexes = Array.from({length: 5}, (_, r) => r * 5 + c);
                const {score: lineWin, indexes: currentWinningIndexes, isStar} = checkLine(lineIndexes);
                if (lineWin > 0) {
                    winScore += lineWin;
                    winningLinesCount++;
                    currentWinningIndexes.forEach(index => winningReelIndexes.add(index));
                    if (isStar) starBonusTriggered = true;
                }
            }

            const diag1Indexes = [0, 6, 12, 18, 24];
            const {score: diag1Win, indexes: diag1WinningIndexes, isStar: isStar1} = checkLine(diag1Indexes);
            if (diag1Win > 0) {
                winScore += diag1Win;
                winningLinesCount++;
                diag1WinningIndexes.forEach(index => winningReelIndexes.add(index));
                if (isStar1) starBonusTriggered = true;
            }
            
            const diag2Indexes = [4, 8, 12, 16, 20];
            const {score: diag2Win, indexes: diag2WinningIndexes, isStar: isStar2} = checkLine(diag2Indexes);
            if (diag2Win > 0) {
                winScore += diag2Win;
                winningLinesCount++;
                diag2WinningIndexes.forEach(index => winningReelIndexes.add(index));
                if (isStar2) starBonusTriggered = true;
            }
            
            score += winScore;
            
            if (winScore > 0) {
                statusLabel.textContent = `Hai vinto! (+${winScore} punti su ${winningLinesCount} linea/e!) üéâ`;
                highlightWinningReels(Array.from(winningReelIndexes), 0);
                if (starBonusTriggered) {
                    createFireworks();
                }
            } else {
                statusLabel.textContent = "Hai perso! üòî Ritenta!";
            }
            
            scoreLabel.textContent = score;
            spinButton.disabled = false;

            if (score <= 0) {
                statusLabel.textContent = "Gioco finito! Ricarica per continuare. üòû";
                spinButton.disabled = true;
            }
        }
        
        function highlightWinningReels(winningReelIndexes, blinkCount) {
            if (blinkCount >= 6) {
                winningReelIndexes.forEach(index => reels[index].classList.remove('win-highlight'));
                return;
            }

            winningReelIndexes.forEach(index => {
                if (blinkCount % 2 === 0) {
                    reels[index].classList.add('win-highlight');
                } else {
                    reels[index].classList.remove('win-highlight');
                }
            });
            
            setTimeout(() => highlightWinningReels(winningReelIndexes, blinkCount + 1), 200);
        }

        function createFireworks() {
            fireworksContainer.innerHTML = '';

            const bonusText = document.createElement('div');
            bonusText.classList.add('bonus-text');
            bonusText.textContent = 'BONUS';
            fireworksContainer.appendChild(bonusText);

            for (let i = 0; i < 50; i++) {
                const firework = document.createElement('div');
                firework.classList.add('firework');
                
                const startX = window.innerWidth / 2 + (Math.random() - 0.5) * 100;
                const startY = window.innerHeight / 2 + (Math.random() - 0.5) * 100;
                firework.style.left = `${startX}px`;
                firework.style.top = `${startY}px`;

                const colors = ['#FFD700', '#FF4500', '#ADFF2F', '#87CEEB', '#DA70D6'];
                firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 150 + 50;
                const endX = startX + Math.cos(angle) * distance;
                const endY = startY + Math.sin(angle) * distance;

                firework.style.setProperty('--end-x', `${endX}px`);
                firework.style.setProperty('--end-y', `${endY}px`);
                firework.style.animationDelay = `${Math.random() * 0.5}s`;

                firework.style.animation = `explode-${i} 1.5s forwards ease-out`;

                const styleSheet = document.styleSheets[0];
                const keyframeRule = `@keyframes explode-${i} {
                    0% { opacity: 1; transform: translate(${startX}px, ${startY}px) scale(0.5); }
                    100% { opacity: 0; transform: translate(${endX}px, ${endY}px) scale(3); }
                }`;
                styleSheet.insertRule(keyframeRule, styleSheet.cssRules.length);

                fireworksContainer.appendChild(firework);

                firework.addEventListener('animationend', () => {
                    firework.remove();
                });
            }

            bonusText.addEventListener('animationend', () => {
                bonusText.remove();
            });
        }

        spinButton.addEventListener('click', () => {
            if (autoPlayInterval) {
                stopAutoPlay();
            }
            spin();
        });

        function startAutoPlay() {
            if (autoPlayInterval) return;
            autoButton.textContent = 'Stop';
            autoButton.style.backgroundColor = '#e74c3c';
            spin();
            autoPlayInterval = setInterval(() => {
                if (score >= spinCost) {
                    spin();
                } else {
                    stopAutoPlay();
                }
            }, 2000);
        }

        function stopAutoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                autoButton.textContent = 'Auto';
                autoButton.style.backgroundColor = '#3498db';
            }
        }

        autoButton.addEventListener('click', () => {
            if (autoPlayInterval) {
                stopAutoPlay();
            } else {
                startAutoPlay();
            }
        });
    </script>
</body>
</html>